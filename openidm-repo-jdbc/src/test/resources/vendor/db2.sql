CREATE SCHEMA wrenidm;

CREATE BUFFERPOOL bpwrenidm32 PAGESIZE 32K;
CREATE TABLESPACE swrenidm_idx PAGESIZE 32K BUFFERPOOL bpwrenidm32; 

CREATE TABLE wrenidm.objecttypes (
  id INTEGER GENERATED BY DEFAULT AS IDENTITY (CYCLE),
  objecttype VARCHAR(255) NOT NULL,
  PRIMARY KEY (id),
  CONSTRAINT idx_objecttypes_objecttype UNIQUE (objecttype)
);

CREATE TABLE wrenidm.genericobjects (
  id INTEGER GENERATED BY DEFAULT AS IDENTITY (CYCLE),
  objecttypes_id INTEGER NOT NULL,
  objectid VARCHAR(255) NOT NULL,
  rev VARCHAR(38) NOT NULL,
  fullobject CLOB(2M),
  PRIMARY KEY (id),
  CONSTRAINT fk_genericobjects_objecttypes FOREIGN KEY (objecttypes_id)
    REFERENCES wrenidm.objecttypes (id) ON DELETE CASCADE,
  CONSTRAINT idx_genericobjects_object UNIQUE (objecttypes_id, objectid)
);

CREATE TABLE wrenidm.genericobjectproperties (
  genericobjects_id INTEGER NOT NULL,
  propkey VARCHAR(255) NOT NULL,
  proptype VARCHAR(32),
  propvalue VARCHAR(2000),
  CONSTRAINT fk_genericobjectproperties_genericobjects FOREIGN KEY (genericobjects_id)
    REFERENCES wrenidm.genericobjects (id) ON DELETE CASCADE
) INDEX IN swrenidm_idx;
CREATE INDEX fk_genericobjectproperties_genericobjects ON wrenidm.genericobjectproperties (genericobjects_id);
CREATE INDEX idx_genericobjectproperties_propkey ON wrenidm.genericobjectproperties (propkey);
CREATE INDEX idx_genericobjectproperties_propvalue ON wrenidm.genericobjectproperties (propvalue);

CREATE TABLE wrenidm.managedgreeting (
  objectid VARCHAR(255) NOT NULL,
  rev VARCHAR(38) NOT NULL,
  name VARCHAR(255),
  priority INTEGER,
  ranking DECIMAL(10, 2),
  visible SMALLINT,
  tags VARCHAR(255),
  meta VARCHAR(2048),
  PRIMARY KEY (objectid)
);
